#!/usr/bin/env ruby

$LOAD_PATH.unshift File.dirname(__FILE__) + '/../lib'
$CELLULA_PATH = File.expand_path(File.dirname(__FILE__)) + '/..'

require 'cellula'
include Cellula

banner

if ARGV[0].nil?
  usage
  exit
end

load ARGV[0].dup
puts @study.say_hello
puts

def to_single(gen)
  str = gen.join
  md = /(.*?)0*$/.match(str)
  md[1]
end

generations = []

@auto.generate(@study) do |num, generation|
  generations << [num, generation]
end

if @study.method == :random
  generations.each do |gen|
    printf "%4s: %s\n", gen[0], gen[1].join()
  end
elsif @study.method == :single
  generations.each do |gen|
    printf "%4s: %s\n", gen[0], gen[1].join()
  end
  puts "Unique numbers: " +
    generations.map{|e| to_single(e[1]).to_i(2)}.uniq.join(', ')
end

